name: Get VieON Channels

on:
  push:
    branches:
      - main  # Chạy workflow khi push lên nhánh main
  schedule:
    - cron: '0 0 * * *'  # Chạy tự động mỗi ngày lúc 00:00 UTC
  workflow_dispatch:  # Cho phép chạy thủ công

jobs:
  get-channels:
    runs-on: ubuntu-latest

    steps:
    # Bước 1: Checkout mã từ repository
    - name: Checkout repository
      uses: actions/checkout@v4

    # Bước 2: Thiết lập Python
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'  # Sử dụng phiên bản Python 3 mới nhất

    # Bước 3: Cài đặt các thư viện cần thiết
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests

    # Bước 4: Chạy script Python
    - name: Run get_channels.py
      env:
        VIEON_USERNAME: ${{ secrets.VIEON_USERNAME }}
        VIEON_PASSWORD: ${{ secrets.VIEON_PASSWORD }}
      run: python get_channels.py

    # Bước 5: Commit và push file channels.txt (nếu có thay đổi)
    - name: Commit and push channels.txt
      run: |
        git config --global user.name "GitHub Actions Bot"
        git config --global user.email "actions@github.com"
        git add channels.txt
        git diff --staged --quiet || git commit -m "Update channels.txt"
        git push
      continue-on-error: true  # Tiếp tục ngay cả khi không có thay đổi để commit

    # Bước 6: (Tùy chọn) Tải file channels.txt lên dưới dạng artifact
    - name: Upload channels.txt as artifact
      uses: actions/upload-artifact@v4
      with:
        name: channels
        path: channels.txt
